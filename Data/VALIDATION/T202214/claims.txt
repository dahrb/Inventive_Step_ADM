MAIN REQUEST - FILED 18 SEPTEMBER 2014

Claims

1. A storage system comprising:

a plurality of storage media (140, 150) organized as hybrid storage media that
cooperate to provide a total storage space of the storage system (120), the hybrid
storage media including solid-state devices (SSDs) and hard disk drives (HDDs);

characterized in that:

the system comprises a log-structured file system (240) that implements a first
data layout format for the SSDs (330) and a second data layout format for the HDDs
(360), said system configured to control the hybrid storage media by performing the
initial placement of data among storage space locations of the hybrid storage media,
migration of selected data from the SSDs to the HDDs, and write allocation of available
storage space locations of the hybrid storage media,

wherein the migration of the selected data from the SSDs (330) to the HDDs
(360) includes:

identifying related file data stored according to said first data layout format at the
SSDs (330),

copying the related file data into a log (146) of the log-structured file system
(240), and

storing the blocks of related file data at the HDDs (360) according to said second
data layout format using regions of the HDDs (360), where each region contains a
contiguous range of file block numbers;

and further wherein a write anywhere technique is implemented for the SSDs
(330) in accordance with the first data layout format to enable placement of data
anywhere in free, available space on the SSDs (330), and a sequential write technique is
implemented for the HDDs (360) in accordance with the second data layout format by
streaming data to the HDDs.

2. The storage system of Claim 1 wherein the log-structured file system (240) is
further configured to implement heuristics and policies directed to types of data
processed by the log-structured file system (240) that initially write the data on any of the
media and thereafter move the data between the media on a block-based level and
without the need for manual enforcement.

24
MAIN REQUEST - FILED 18 SEPTEMBER 2014

3. The storage system of Claim 2, further comprising a SSD controller (335) of each
SSD (330), wherein the HDDs (360) are apportioned into the regions of related file data
in accordance with the second data layout format of the log-structured file system (240),
and the log-structured file system (240) implements placement of file data within the
regions of the HDDs (360) by designating block locations on the HDDs (360) where the
data resides.

4. The storage system of Claim 3, wherein the log-structured file system (240)
further applies log-structured techniques to find blocks having free space which are
cleaned such that the translational logic of the SSD controllers is adapted to map with
less granularity than the erase block granularity and further to move data at a block-
based level between the SSDs (330) and HDDs (360).

5. The storage system of Claim 1, further comprising a RAID module (320)
configured to cooperate with the log-structured file system (240) to control storage
operations to the SSDs (330) and HDDs (360), wherein the RAID module (320) is
configured to organize the SSDs (330) as one or more parity groups and manage parity
computations and topology information used for placement of data on the SSDs (330) of
each group.

6. The storage system of Claim 5, further comprising a SSD controller (335) of each
SSD (330), the SSD controller (335) configured to export geometry information to the
RAID module (320), the geometry information including a size of the SSD in terms of
device block numbers (dbns), wherein a dbn is a logical address that the SSD controller
(335) presents to the RAID module (320) and that is subject to translation mapping by
translation logic (336) of the SSD controller (335) to a physical address of the SSD.

7. The storage system of Claim 6, wherein the translation logic (336) is configured
to perform wear levelling to reduce failure of the SSD (330) due to repeated erasure and

writing of the SSD (330).

8. The storage system of Claim 7, wherein, in response to accessing an erase block
via a write operation, the translation logic (336) moves the erase block to a new location

25
MAIN REQUEST - FILED 18 SEPTEMBER 2014

on the SSDs and makes a previous location of the block available for reuse by a
subsequent write operation.

9. The storage system of Claim 1, wherein:

the HDDs (360) are apportioned into the regions; and

the first data layout format provides write access to data containers stored on the
SSDs (330) to enable servicing of random data access operations directed to the SSD
array (340), and the second data layout format provides sequential read access to large
data containers stored on the HDDs to enable servicing of data stored on the HDDs
(360).

10. The storage system of Claim 9, wherein the HDDs (360) are organized as an
HDD array (350), and

data is moved sequentially to the HDDs (360) of the HDD array (350) using the
second data layout format.

11. A method of operating a storage system comprising a plurality of storage media
(140, 150) organized as hybrid storage media that cooperate to provide a total storage
space of the storage system (120), the hybrid storage media including solid-state
devices (SSDs) and hard disk drives (HDDs), said method being characterized by:

providing in the system a log-structured file system (240) that implements a first
data layout format for the SSDs (330) and a second data layout format for the HDDs
(360);

said system controlling the hybrid storage media by performing the initial
placement of data among storage space locations of the hybrid storage media, migration
of selected data from the SSDs to the HDDs, and write allocation of available storage
space locations of the hybrid storage media,

wherein the migration of the selected data from the SSDs (330) to the HDDs
(360) includes:

identifying related file data stored according to said first data layout format at the
SSDs (330),

copying the related file data into a log (146) of the log-structured file system
(240), and

26
MAIN REQUEST - FILED 18 SEPTEMBER 2014

storing the blocks of related file data at the HDDs (360) according to said second
data layout format using regions of the HDDs (360), where each region contains a
contiguous range of file block numbers;

and further comprising implementing a write anywhere technique for the SSDs
(330) in accordance with the first data layout format to enable placement of data
anywhere in free, available space on the SSDs (330), and a sequential write technique
for the HDDs (360) in accordance with the second data layout format by streaming data
to the HDDs.

12. The method of Claim 11, further comprising:
moving selected data stored on the SSDs (330) to the HDDs (360).

13. The method Claim 12, wherein moving selected data comprises:

retrieving the selected data from the SSDs (330) into a memory of the storage
system (120); and

storing the retrieved selected data to one or more regions of the HDDs (360).

27
